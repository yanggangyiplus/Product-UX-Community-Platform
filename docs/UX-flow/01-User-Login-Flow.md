# User Login Flow

## 개요
사용자 로그인 플로우는 일반 로그인과 소셜 로그인(OAuth) 두 가지 경로를 지원합니다.

## 플로우 다이어그램

```
[로그인 페이지]
    |
    ├─ [일반 로그인 선택]
    |     |
    |     ├─ [이메일/비밀번호 입력]
    |     |     |
    |     ├─ [유효성 검사]
    |     |     ├─ 실패 → 에러 메시지 표시
    |     |     └─ 성공 → API 호출
    |     |
    |     ├─ [API 응답 처리]
    |     |     ├─ 실패 → 에러 메시지 표시
    |     |     └─ 성공 → 토큰 저장 → 홈으로 리다이렉트
    |
    └─ [소셜 로그인 선택]
          |
          ├─ [OAuth 제공자 선택 (카카오/네이버/구글)]
          |     |
          |     ├─ [OAuth URL 요청]
          |     |     ├─ 실패 → 에러 메시지 표시
          |     |     └─ 성공 → OAuth 제공자 페이지로 리다이렉트
          |
          ├─ [OAuth 제공자에서 인증]
          |     |
          |     ├─ [사용자 승인]
          |     |     ├─ 거부 → 로그인 페이지로 리다이렉트 (에러)
          |     |     └─ 승인 → 콜백 URL로 리다이렉트 (코드 포함)
          |
          ├─ [콜백 처리]
          |     |
          |     ├─ [백엔드에서 토큰 교환]
          |     |     ├─ 실패 → 로그인 페이지로 리다이렉트 (에러)
          |     |     └─ 성공 → 사용자 정보 조회/생성 → 토큰 생성
          |
          └─ [프론트엔드 콜백 페이지]
                |
                ├─ [토큰 수신]
                |     ├─ 없음 → 로그인 페이지로 리다이렉트 (에러)
                |     └─ 있음 → 토큰 저장 → 홈으로 리다이렉트
```

## 상세 시나리오

### 시나리오 1: 일반 로그인 성공

1. 사용자가 로그인 페이지 접근
2. 이메일과 비밀번호 입력
3. "로그인" 버튼 클릭
4. 프론트엔드에서 입력값 유효성 검사
5. `/api/auth/login` API 호출
6. 백엔드에서 사용자 인증
7. JWT 토큰 생성 및 반환
8. 프론트엔드에서 토큰을 localStorage에 저장
9. 홈 페이지로 리다이렉트

### 시나리오 2: 일반 로그인 실패

1. 사용자가 로그인 페이지 접근
2. 이메일과 비밀번호 입력
3. "로그인" 버튼 클릭
4. API 호출
5. 백엔드에서 인증 실패 (잘못된 이메일/비밀번호)
6. 에러 응답 반환
7. 프론트엔드에서 에러 메시지 표시
8. 사용자가 다시 입력 시도

### 시나리오 3: 소셜 로그인 (카카오) 성공

1. 사용자가 로그인 페이지 접근
2. "카카오로 시작하기" 버튼 클릭
3. `/api/auth/oauth/kakao` API 호출하여 인증 URL 획득
4. 카카오 인증 페이지로 리다이렉트
5. 사용자가 카카오 계정으로 로그인 및 승인
6. 카카오에서 콜백 URL로 리다이렉트 (인증 코드 포함)
7. 백엔드 `/api/auth/callback/kakao`에서 코드로 토큰 교환
8. 카카오 사용자 정보 조회
9. OAuthAccount 테이블에서 기존 계정 확인 또는 신규 생성
10. JWT 토큰 생성
11. 프론트엔드 콜백 페이지로 리다이렉트 (토큰 포함)
12. 프론트엔드에서 토큰 저장
13. 홈 페이지로 리다이렉트

### 시나리오 4: 소셜 로그인 취소

1. 사용자가 소셜 로그인 버튼 클릭
2. OAuth 제공자 페이지로 이동
3. 사용자가 "취소" 또는 "거부" 선택
4. 에러와 함께 로그인 페이지로 리다이렉트
5. 에러 메시지 표시

## 예외 처리

### 네트워크 오류
- **상황**: API 호출 실패
- **처리**: "네트워크 오류가 발생했습니다. 다시 시도해주세요." 메시지 표시
- **UX**: 로딩 상태 해제, 재시도 가능

### 토큰 만료
- **상황**: API 호출 시 401 응답
- **처리**: localStorage에서 토큰 제거, 로그인 페이지로 리다이렉트
- **UX**: "세션이 만료되었습니다. 다시 로그인해주세요." 메시지 표시

### OAuth 설정 오류
- **상황**: OAuth 클라이언트 ID/Secret 미설정
- **처리**: 백엔드에서 에러 응답, 프론트엔드에서 에러 메시지 표시
- **UX**: "로그인 서비스를 일시적으로 사용할 수 없습니다." 메시지 표시

## UX 고려사항

1. **로딩 상태**: 로그인 요청 중에는 버튼 비활성화 및 로딩 표시
2. **에러 메시지**: 명확하고 사용자 친화적인 에러 메시지 제공
3. **자동 리다이렉트**: 로그인 성공 시 자동으로 홈으로 이동
4. **소셜 로그인 버튼**: 각 제공자의 브랜드 색상 및 아이콘 사용
5. **반응형 디자인**: 모바일에서도 사용하기 편한 UI

## 성능 최적화

1. **토큰 캐싱**: localStorage에 토큰 저장하여 재로그인 불필요
2. **OAuth URL 캐싱**: 인증 URL은 세션 동안 캐싱 가능
3. **에러 재시도**: 네트워크 오류 시 자동 재시도 메커니즘

