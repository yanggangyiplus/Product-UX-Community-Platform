# Report Flow (신고 플로우)

## 개요
사용자가 부적절한 게시글 또는 댓글을 신고하는 플로우입니다. 중복 신고 방지 및 관리자 처리 과정을 포함합니다.

## 플로우 다이어그램

```
[게시글/댓글 페이지]
    |
    ├─ [신고 버튼 클릭]
    |     |
    |     ├─ [로그인 확인]
    |     |     ├─ 미로그인 → 로그인 페이지로 리다이렉트
    |     |     └─ 로그인됨 → 신고 모달 표시
    |
    ├─ [신고 모달]
    |     |
    |     ├─ [신고 유형 선택]
    |     |     ├─ 스팸
    |     |     ├─ 욕설/비방
    |     |     ├─ 음란물
    |     |     ├─ 저작권 침해
    |     |     └─ 기타
    |     |
    |     ├─ [신고 사유 입력]
    |     |     ├─ 선택한 유형에 따른 안내 문구 표시
    |     |     └─ 상세 사유 입력 (선택사항)
    |     |
    |     ├─ [신고 제출]
    |     |     |
    |     |     ├─ [유효성 검사]
    |     |     |     ├─ 신고 유형 미선택 → 에러 메시지
    |     |     |     └─ 통과
    |     |
    |     |     ├─ [API 호출: POST /api/reports]
    |     |     |     |
    |     |     ├─ [중복 신고 확인]
    |     |     |     ├─ 이미 신고함 → "이미 신고한 항목입니다" 메시지
    |     |     |     └─ 신고 가능
    |     |
    |     |     ├─ [신고 생성]
    |     |     |     ├─ 실패 → 에러 메시지 표시
    |     |     |     └─ 성공 → "신고가 접수되었습니다" 메시지
    |     |
    |     └─ [모달 닫기]
    |
    └─ [관리자 처리 플로우]
          |
          ├─ [관리자 페이지 접근]
          |     ├─ 로그인 확인
          |     └─ 관리자 권한 확인
          |
          ├─ [신고 목록 조회]
          |     ├─ [필터링]
          |     |     ├─ 상태별 (대기/처리중/완료/거부)
          |     |     └─ 유형별 (게시글/댓글)
          |
          ├─ [신고 상세 확인]
          |     ├─ 신고된 게시글/댓글 내용 확인
          |     ├─ 신고 사유 확인
          |     └─ 신고자 정보 확인
          |
          ├─ [신고 처리]
          |     |
          |     ├─ [처리 중으로 변경]
          |     ├─ [신고 대상 확인]
          |     |     ├─ 위반 사항 확인 → 삭제 또는 경고
          |     |     └─ 위반 사항 없음 → 신고 거부
          |
          |     ├─ [처리 완료]
          |     |     ├─ 상태 변경 (완료/거부)
          |     |     ├─ 처리 사유 입력
          |     |     └─ 신고자에게 알림 (선택사항)
          |
          └─ [신고 처리 완료]
```

## 상세 시나리오

### 시나리오 1: 게시글 신고 성공

1. 사용자가 게시글 페이지에서 "신고" 버튼 클릭
2. 로그인 상태 확인
3. 신고 모달 표시
4. 신고 유형 선택 (예: "욕설/비방")
5. 상세 사유 입력 (선택사항)
6. "신고하기" 버튼 클릭
7. 프론트엔드에서 유효성 검사
8. `/api/reports` API 호출 (POST)
   - report_type: "post"
   - post_id: 게시글 ID
   - reason: 신고 사유
9. 백엔드에서 중복 신고 확인
10. 신고 생성 (status: PENDING)
11. "신고가 접수되었습니다. 검토 후 조치하겠습니다." 메시지 표시
12. 모달 닫기

### 시나리오 2: 댓글 신고 성공

1. 사용자가 댓글 옆 "신고" 버튼 클릭
2. 로그인 상태 확인
3. 신고 모달 표시
4. 신고 유형 선택
5. 상세 사유 입력
6. "신고하기" 버튼 클릭
7. `/api/reports` API 호출
   - report_type: "comment"
   - comment_id: 댓글 ID
   - reason: 신고 사유
8. 신고 생성
9. 성공 메시지 표시

### 시나리오 3: 중복 신고 방지

1. 사용자가 이미 신고한 게시글에 대해 다시 "신고" 버튼 클릭
2. 신고 모달 표시
3. 신고 유형 선택 및 제출
4. API 호출
5. 백엔드에서 중복 신고 확인
   - 같은 사용자가 같은 항목에 대해 PENDING 상태의 신고가 있음
6. 에러 응답: "이미 신고한 항목입니다."
7. 프론트엔드에서 에러 메시지 표시
8. 모달 닫기

### 시나리오 4: 관리자 신고 처리

1. 관리자가 관리자 페이지 접근
2. "신고 관리" 메뉴 클릭
3. 신고 목록 표시 (기본: PENDING 상태)
4. 필터링 옵션 선택 (상태별, 유형별)
5. 신고 항목 클릭하여 상세 확인
   - 신고된 게시글/댓글 내용
   - 신고 사유
   - 신고자 정보
   - 신고 일시
6. 위반 사항 확인
7. 처리 결정
   - 위반 사항 있음: 게시글/댓글 삭제 또는 경고
   - 위반 사항 없음: 신고 거부
8. 신고 상태 변경 API 호출 (`PUT /api/admin/reports/{id}`)
   - status: "resolved" 또는 "rejected"
   - admin_note: 처리 사유
9. 처리 완료

### 시나리오 5: 신고 처리 알림 (선택사항)

1. 관리자가 신고 처리 완료
2. 신고자에게 알림 전송 (이메일 또는 인앱 알림)
3. 알림 내용: "신고하신 항목이 검토되어 조치되었습니다."
4. 사용자가 알림 확인

## 예외 처리

### 로그인 필요
- **상황**: 비로그인 사용자가 신고 버튼 클릭
- **처리**: 로그인 페이지로 리다이렉트
- **UX**: "신고 기능을 사용하려면 로그인이 필요합니다." 메시지 표시

### 중복 신고
- **상황**: 같은 사용자가 같은 항목을 이미 신고함
- **처리**: "이미 신고한 항목입니다." 메시지 표시
- **UX**: 신고 버튼 비활성화 또는 이미 신고한 상태 표시

### 신고 대상 삭제됨
- **상황**: 신고하려는 게시글/댓글이 이미 삭제됨
- **처리**: "이미 삭제된 항목입니다." 메시지 표시
- **UX**: 신고 모달 닫기

### 관리자 권한 없음
- **상황**: 일반 사용자가 관리자 페이지 접근 시도
- **처리**: 403 에러, 접근 거부
- **UX**: "관리자 권한이 필요합니다." 메시지 표시

## UX 고려사항

1. **신고 버튼 위치**: 게시글/댓글 옆에 명확하게 표시
2. **신고 모달**: 간단하고 명확한 UI, 신고 유형 선택이 쉬워야 함
3. **신고 사유 안내**: 각 신고 유형에 대한 설명 제공
4. **신고 처리 상태**: 사용자가 자신이 신고한 항목의 처리 상태 확인 가능
5. **피드백**: 신고 접수 및 처리 완료 시 명확한 피드백 제공

## 보안 고려사항

1. **중복 신고 방지**: 같은 사용자가 같은 항목을 여러 번 신고하지 못하도록 제한
2. **악의적 신고 방지**: 신고 횟수 제한 또는 패턴 감지
3. **관리자 권한**: 신고 처리 기능은 관리자만 접근 가능
4. **로그 기록**: 모든 신고 및 처리 내역 기록

## 성능 최적화

1. **신고 목록 페이지네이션**: 많은 신고가 있을 경우 페이지네이션 적용
2. **필터링 최적화**: 상태별, 유형별 필터링 시 인덱스 활용
3. **알림 배치 처리**: 신고 처리 알림을 배치로 처리하여 성능 개선

## 접근성

1. **키보드 접근**: 신고 버튼 및 모달을 키보드로 접근 가능
2. **스크린 리더**: 신고 모달의 모든 요소에 적절한 라벨 제공
3. **명확한 안내**: 신고 유형 선택 시 명확한 설명 제공

